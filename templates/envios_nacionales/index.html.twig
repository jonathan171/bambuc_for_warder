{% extends 'base.html.twig' %}
{% import "macros/redirect.html.twig" as macroRedirect %}
{% block title %}Remisiones{% endblock %}

{% block body %}
    <h1>Listado De Remisiones</h1>
    {% for message in app.flashes('notice') %}

		<div class="alert alert-info alert-dismissible fade show" role="alert">
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
      <strong>
			{{ message }}
       </strong>
		</div>
	{% endfor %}
<div class="p-3">
    <div class="form-group ">
        <a class="btn waves-effect waves-light btn-success" href="{{ path('app_envios_nacionales_new') }}">Nueva Remision</a>
        <a class="btn waves-effect waves-light btn-success" href="{{ path('app_migracion_exportar_envio') }}">Exportar Envios</a>
        <a class="btn waves-effect waves-light btn-success" href="{{ path('app_migracion_importar_472') }}">Importar Envios</a>
        <a class="btn waves-effect waves-light btn-info" onclick="imprimirStiker()">Imprimir Stikers</a>
        <a class="btn waves-effect waves-light btn-warning" onclick="imprimirRemision()">Imprimir Remisiones</a>
  </div>
</div>
<div class="table-responsive">
<div id="zero_config_wrapper" class="dataTables_wrapper container-fluid dt-bootstrap4">
<div class="col-sm-12">
    <table class="table table-striped table-bordered display text-nowrap dataTable no-footer" style="width: 100%;" id="data_table_envios">
        <thead>
            <tr>
                
                <th>N° Guia</th>
                <th>Fecha Envio</th>
                <th>Quien Envia</th>
                <th>Quien Recibe</th>
                <th>Municipio Destino</th>
                <th>Opciones</th>
               
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
    </div>
    </div>
</div>
<div class="col-lg-2">
  <a class="justify-content-center w-100 btn btn-success d-flex align-items-center" href="{{ path('app_envios_nacionales_new') }}">Nueva Remision</a>
</div>
<div id="verEnvio" title="Envio" style="display:none;width:800px;height:500px;" >

    <div class="input-group">
    </div>

    <div id="diverEnvio" >
    </div>

</div>  
{% endblock %}
{% block javascripts %} 
{{ macroRedirect.scriptRedirect}}
<script>
    
  $(document).ready(function() {
   
      $('#data_table_envios').DataTable({
            serverSide: true,
            responsive: true,
            pageLength: 50,
            sPaginationType: "full_numbers",
            language: {
                "url": "https://cdn.datatables.net/plug-ins/1.10.16/i18n/Spanish.json"
            },
            ajax: {
                "url": '/envios_nacionales/table',
                "type": "POST"
            },
            columns: [
                {data: 'numero'},
                {data: 'fecha'},
                {data: 'cliente'},
                {data: 'destinatario'},
                {data: 'municipioDestino'},
                {data: 'actions'}
                
                ],
            columnDefs: [
                
            ],
             order: [[ 0, "desc" ]]
        });
   });
    
   
    function verEnvio(idEnvio) {

        ParaEnvio = '/envios_nacionales/'+idEnvio+'/mostrar';


        $('#diverEnvio').load(ParaEnvio, {});

        $("#verEnvio").dialog({ width: 800, height: 500});

    }
    function ocultarEnvio(idEnvio) {

        

        $("#verEnvio").dialog('close');

    }
    function verificar(id){
       $('#verificar'+id).hide();
       $.ajax({
        url : '{{ path('app_envio_verificar')}}',
        data : { id : id},
        type : 'POST',
        dataType : 'json',
        success : function(json) {

         alertify.success('Envio Verificado correctamente');
        location.reload();

            },
       error : function(xhr, status) {
        alert('Disculpe, existió un problema');
       }
          });

    }
    function imprimirStiker(){
        datos = [];
        $("input[name='envId[]']:checked").each(
            function() {
                datos.push({remision: $(this).val()});
                
                }
            );
        
        $.redirect('{{ path('app_impresion_stiker_todos')}}',{datos:datos},"POST");


    }
    function imprimirRemision(){
         datos = [];
        $("input[name='envId[]']:checked").each(
            function() {
                datos.push({remision: $(this).val()});
                
                }
            );
         $.redirect('{{ path('app_impresion_remision_todos')}}',{datos:datos},"POST");

    }
</script>   
{% endblock %}
